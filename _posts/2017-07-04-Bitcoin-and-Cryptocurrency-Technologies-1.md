---
layout: post
title: 《比特币与加密货币技术1》：密码学及加密货币概述
categories: geek
mathjax: true
---

所有的货币都存在供给问题和安全问题，而加密数字货币还要防止“混淆”。（数字货币相比实体货币，具有可复制性）。

密码学提供了一个将加密货币体系规则编码到系统本身的机制，用于防止对系统的干扰。避免混淆，乃至制定货币的创造规则。比特币应用主要密码学概念主要有哈希算法和数字签名，都很基础，稍微复杂一点的用到了零知识验证。

### 1.1 哈希函数

哈希函数的三个基本特征：

1. 输入可为任意大小的字符串；
2. 产生固定大小的输出；
3. 计算复杂度为$$O(n)$$,其中$$n$$为字符串长度。

用于加密的哈希函数还需要三个附加特性：

1. 碰撞阻力，无法找到两个值，$$x$$和$$y$$，$$x \neq y$$，而$$H(x)=H(y)$$，则称哈希函数具有碰撞阻力。实际上碰撞肯定时存在的，只是无法用有效的方法（可以接受的时间）找到，而且这种防碰撞是实践意义上的，而不是理论上可证明的。碰撞阻力的最常见应用是信息摘要，只要两个信息的摘要没有发生变化，就可以认为信息没有发生变化，这样可以大大提高比对的速度，比如很多软件提供下载时，都会同时提供sig文件用于校验文件的正确性。
2. 隐秘性，当其输入$$r$$选自一个高阶最小熵的概率分布，在给定$$H(r\parallel x)$$条件下来确定x是不可行的。这个特性是考虑在已知Hash值的情况下，不能让人猜出原来的字符串，而在输入空间有限的时候，则将其与及其分散的r拼接起来，起到混淆的作用。可以使用哈希函数实现承诺协议，先取信息msg和临时随机数nonce的Hash值，得到一个承诺com，在验证时，提供com，nonce以及原来的msg。由隐秘性可知，已知com是找不出msg来的，另外由碰撞阻力可知，找不到一组msg‘，nonce’，和原来的Hash值相同。这个承诺协议的作用类似于古代的火漆封印。
3. 谜题友好，对于任意$$n$$位输出值$$y$$，假定$$k$$选自高阶最小熵分布，无法找到一个可行的办法，在比$$2^n$$小很多时间内找到$$x$$，保证$$H(k\parallel x)=y$$成立。注意相比隐秘性，这里y具有任意性。可以据此构造一种搜索谜题，给定哈希函数$$H$$，随机的谜题$$id$$，目标集合$$Y$$，寻找一个解$$x$$满足$$H(id\parallel x)\in Y$$以此保证唯一可行的策略就是暴力尝试。

比特币中使用了SHA-256算法。

### 1.2 哈希指针及数据结构

注意Hash指针不是C语言中那种指针，首先它是一个区块的Hash值，因此可以用它来验证一个区块，其次，可以建立一个Hash值到区块的数据库，用于查找相应的区块，起到指针的作用。（类似一般意义上的Hash表）

使用哈希指针替代C语言意义中的指针，可以用于无循环的数据结构，用于链表时，叫做区块链，用于二叉树，则叫做梅克尔树。通过这种链式结构，我们只需要知道头指针，就可以逐级验证区块内容是否被篡改。

要证明一个区块隶属于一个梅克尔树，只需要提供该去看到根节点的路径即可，如果区块有排序，则可以证明某个区块不属于该梅克尔树。

### 1.3 数字签名

数字签名方案由三个算法构成：

1. 生成公钥、私钥对；
2. 使用私钥签署消息得到签名；
3. 使用公钥、签名、消息，进行验证。

特征：

1. 有效的签名必须通过验证；
2. 不可伪造性。

在实践中，需要注意：

1. 需要随机性的良好来源；
2. 都信息的Hash值进行签署（对Hash指针进行签署），可以提高效率。

比特币使用了ECDSA签名算法。

### 1.4 公钥即身份

能使用公钥验证的信息，必然是由知道私钥的人发出的，因此公钥可作为身份的象征。

使用公钥作为身份有一定的匿名性，但是通过社会工程学是有可能在公钥和真实身份间建立联系的，一旦如此，比特币的所有交易记录其实是公开的。

公钥想要多少就有多少，比特币并不是固定地址交易的。

比特币地址就是公钥的hash值。

### 1.5 两种简单的加密货币

高飞币的规则：

1. 高飞可以签署声明创造新币；
2. 币的所有人可以签署声明转让给另一个人；
3. 所有人都可以验证币的有效性，跟随哈希指针追溯。

高飞币的主要问题：双重支付。

财奴币以高飞币为基础，但是由财奴负责维护仅增账本，由财奴签名确保区块链中每一笔交易的有效性，防止双重支付，财奴币的问题是需要财奴这个中心化的实体。