---
layout: post
title: 《比特币与加密货币技术4》：如何存储和使用比特币
categories: geek
mathjax: true
---

### 4.1 简单的本地储存

储存比特币其实就是如恶化保存和管理比特币私钥。（因为其他信息都在区块链上，可以随时调取。）

不同的密钥管理办法就是对可获取性、安全性和便利性的权衡。

将密钥存储在本地设备：可获取性和安全性不好。

比特币钱包可以管理密钥和地址的生成，地址可以使用Base58编码或二维码传播。包含特定字母的地址可以通过暴力生成，称为虚荣地址，其生成的计算量根据需要的位数呈指数级增长。

### 4.2 热储存与冷储存

**热储存**是在线的，而冷储存则不接入互联网，相对安全。

**冷储存**无需在线就可以接收比特币。热存储需要知道冷储存的地址，这样才能转账。为了每次让冷储存的地址不一样：

1. 一次性生成一批地址：地址传送的问题
2. 使用分层确定性钱包：让冷储存制造无限制的地址熟练，然后通过一个短暂的、一次性的交换让热存储知晓。


私钥生成信息：$$k$$，$$x$$，$$y$$
第$$i$$个私钥 $$x=y+H(k\parallel i)$$
地址生成信息：$$k$$，$$g^y$$
第$$i$$个公钥 $$g^{x^i}=g^{H(k\parallel i)}\ \cdot g^y$$
第$$i$$个地址 $$H(g^{x^i})$$

**大脑钱包**：通过一个密码支取比特币。黑客可以无限次的离线攻击（只要他掌握了你生成密钥的步骤。）

**纸钱包**：使用纸张保存公私钥匙。

**防损硬件** 用于保存或生成密钥。

### 4.3 密钥分存和密钥共享

**密钥分存** 密钥被分成N个片段，只要我们获取其中的K个片段，就可以把原密钥重新还原。但如果获得的片段数少于K，就无法知道关于密钥的任何信息。

| 公式                               | 自由度  | 形状   | 随机参数              | 还原密钥所需的子密钥数量 |
| -------------------------------- | ---- | ---- | ----------------- | ------------ |
| $$(S+RX) mod P$$                 | 1    | 直线   | $$R$$             | 2            |
| $$(S+R_1X+R_2X^2) mod P$$        | 2    | 二次曲线 | $$R_1, R_2$$      | 3            |
| $$(S+R_1X+R_2X^2+R_3X^3) mod P$$ | 3    | 三次曲线 | $$R_1, R_2, R_3$$ | 4            |

这不是比特币的专用技术，实际中因为使用不方便而应用较少。

上述方法需要还原出原密钥，这个过程可能不安全。使用门限签名可以解决：讲一个密钥分存不同的片段分别存储，在交易签名时无需还原原密钥。

使用多重签名也可以保证N个人中必须有K个签名才能使交易成立。

### 4.4 在线钱包和交易所

在线钱包使用方便，安全性主要由服务商保证。

比特币交易所通过更改合约进行货币兑换，它和银行一样存在三类风险：挤兑、庞氏骗局与黑客入侵（有可能是监守自盗）。

银行监管中有最低准备金要求，政府还充当最后借款人角色。比特币交易所通过算法可以实现类似的准备金证明。首先可以通过转账交易证明交易所或交易所的关联方持有准备金的上限X（可以动用的），其次可以通过储户姓名和金额构成的梅克尔树证明交易所的负债的下限Y，用户可以申请存款证明。据此可以得到准备金比例X/Y。这种算法泄露了顾客信息。

### 4.5 支付服务

商家使用法币定价，实时按汇率收取消费者的比特币，支付服务商真正收取比特币，向商家支付法币，从而承担汇率变动的风险。在消费过程中，支付服务商和消费者承担汇率变动风险，而商家则不用承担。

由于收取了大量的比特币，支付服务商一般是交易所的活跃成员。

### 4.6 交易费

默认交易费政策，满足以下条件不收费：

1. 交易小于1000个字节。
2. 所有输出为0.01BTC或更大。
3. 优先权足够高。（优先权=所有输入的账龄的总和X输入金额/交易规模）。

收费的默认标准：每1000 个字节支付0.0001BTC。

如果需要交易尽快纳入区块链，那么建议支付较高的费用。

交易费策略可以由节点自己确定。

### 4.7 货币兑换市场

比特币的公允价格由供给和需求决定。比特币供给的上限是2100万，一般将流通货币或活期存款计入供给总量。

而比特币的需求则分为两类：一是作为支付中介（用于支付的比特币将短暂的退出流通体系），二是作为投资需求。（需要长期持有）

记T为比特币支付总交易量（以美元记），D指比特币支付时，暂时退出的时间长度，S是人们可以买到的比特币总量，最有P是比特币对美元的价格。

$$S/D=T/P =>P=\frac {TD}  S$$

所以价格P和需求T是成正比的。