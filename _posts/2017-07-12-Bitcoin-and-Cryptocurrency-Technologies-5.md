---
layout: post
title: 《比特币与加密货币技术5》：比特币挖矿
categories: geek
mathjax: true
---

### 5.1 比特币矿工的任务

1. 监听交易广播。
2. 维护区块链网络和监听新的区块。
3. 组装一个备选区块。
4. 找到一个让你的区块有效的随机数。
5. 希望你的区块被全接受。
6. 利润。

矿工的任务分为两类：验证交易和区块（这是比特币网络赖以生存和运转的基础），以及和其他矿工竞争。

#### 寻找有效区块

矿工在组装交易后，可以更改两个随机数，一个在梅克尔树底部的币基参数，一个是区块头部的随机数，其中更改第一个需要计算重新计算梅克尔树的Hash值，代价较大。

#### 决定难度

$$下一个难度=\frac {上一个难度\times 2016 \times 10分钟}{产生上2016个区块所花费的时间}$$

维持10分钟产生一个新的区块速度，每产生2016个区块调整一次（2016个十分钟是2周）

### 5.2 挖矿所需硬件

比特币挖矿主要的计算是SHA-256。针对SHA-256的计算，比特币的硬件经历的大约四个时代。

1. CPU（按2015年难度徐几十万年）
2. GPU（几百年）
3. FPGA
4. ASIC（矿机）

### 5.3 能源消耗和生态环保

**热力学限制**，蓝道尔原理指出，任何一位运算都会消耗$$kTIn2$$焦耳的能量，SHA-256计算是不可逆的，需要消耗能源，这是比特币挖矿耗能的下限。比特币挖矿能耗分为三个部分：

1. 内涵能源
2. 电能
3. 冷却

大规模挖矿时，一般内涵能源和电能消耗减少，冷却消耗增加。

自上而下估算，假设所有的电费都相等，矿工把挖矿所得美金完全用于电费。自下而上估算，假设所有矿工都使用最高效的矿机（每秒30亿次Hash运算）。结合两种方法，推导出比特币挖矿大概需要MW的数量级。相当于一个大型电厂总发电量的10%。

比特币网络作为一个货币支付系统，消耗一定的能源是可以接受的。

值得探讨的节约能源的方法有：

1. 用更加节省能源的解密算法来代替现在的比特币挖矿；
2. 把挖矿过程中产生的热能进行二次利用（供暖）

可以把挖矿视为将电力转换为现金的过程，这样就存在利用政府补贴乃至偷电的行为。

### 5.4 矿池

挖矿是一种高方差的行为，所以矿工面临极大的不确定性危险。（平均收益很多时候无法保证）。

矿池是比特币矿工互相之间的保险。一组矿工可以形成一个矿池共同进行挖矿，并指定矿池管理员为币基接收人，由他来分配区块奖励。矿工的工作量由挖矿工分来衡量，也就是矿工计算出的接近有效区块的区块数（比要求的Hash值重的0数量略少）。奖励分配方案主要包括：

1. 工分分红，对每一个超过特定区块难度的工分发放固定的奖励分红。这个模式的问题是，矿工没有动力把有效区块提交给管理员。
2. 按实际比例分红：矿池在发现有效区块后再按工分比例分红。

矿工可能选择切换矿池的策略来获得更高的收益。

矿池协议已经成为一种事实标准，甚至被内嵌到矿机中。

矿池的壮大有控制算力的危险。

### 5.5 挖矿的激励和策略

默认策略：

1. 选择那些缴费比较高的交易打包；
2. 扩展最长的区块链；
3. 发生冲突时，选择最先听到的区块扩展；
4. 立即宣布新发现的区块。

**分叉攻击** 跳到之前的区块继续挖矿，依靠算力的强大覆盖当前的最长链。算力越大，成功的概率越高。这种攻击很容易被察觉到，长期来看，攻击者打击了比特币信心和汇率，会得不偿失，实际的攻击者应该目的在于打击比特币信心。这种攻击也可以通过贿赂达成。

**临时保留区块攻击** 找到区块后不立即公布，而是等别人公布后再公布。如果有50%的概率赢得区块竞争，则25%算力时，这种策略更优，有33.3%算力时，这种策略即使输掉区块竞争依然可以获得更高的收益。自私挖矿很容易被检测到。

**黑名单和惩罚分叉攻击** 需要有较高的算力来威胁别人。

**羽量级分叉** 当k个区块证实了交易的正当性的时候，你才放弃封杀，回到最长链，如果你在一个区块证实后放弃，则成功封杀的概率是算力比率的平方，即使如此，对其它矿工依然是很大的威胁。

随着区块奖励不断减半，挖矿的激励将逐渐转化到交易费上，到时候挖矿的生态如何，仍然是未解决的问题。



